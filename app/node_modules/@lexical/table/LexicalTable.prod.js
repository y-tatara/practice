/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

'use strict';var h=require("@lexical/utils"),w=require("lexical"),aa=require("@lexical/clipboard");let ba=/^(\d+(?:\.\d+)?)px$/,x={BOTH:3,COLUMN:2,NO_STATUS:0,ROW:1};
class y extends w.ElementNode{static getType(){return"tablecell"}static clone(a){return new y(a.__headerState,a.__colSpan,a.__width,a.__key)}afterCloneFrom(a){super.afterCloneFrom(a);this.__rowSpan=a.__rowSpan;this.__backgroundColor=a.__backgroundColor}static importDOM(){return{td:()=>({conversion:ca,priority:0}),th:()=>({conversion:ca,priority:0})}}static importJSON(a){let b=a.rowSpan||1;return B(a.headerState,a.colSpan||1,a.width||void 0).setRowSpan(b).setBackgroundColor(a.backgroundColor||null)}constructor(a=
x.NO_STATUS,b=1,c,d){super(d);this.__colSpan=b;this.__rowSpan=1;this.__headerState=a;this.__width=c;this.__backgroundColor=null}createDOM(a){let b=document.createElement(this.getTag());this.__width&&(b.style.width=`${this.__width}px`);1<this.__colSpan&&(b.colSpan=this.__colSpan);1<this.__rowSpan&&(b.rowSpan=this.__rowSpan);null!==this.__backgroundColor&&(b.style.backgroundColor=this.__backgroundColor);h.addClassNamesToElement(b,a.theme.tableCell,this.hasHeader()&&a.theme.tableCellHeader);return b}exportDOM(a){({element:a}=
super.exportDOM(a));if(a){a.style.border="1px solid black";1<this.__colSpan&&(a.colSpan=this.__colSpan);1<this.__rowSpan&&(a.rowSpan=this.__rowSpan);a.style.width=`${this.getWidth()||75}px`;a.style.verticalAlign="top";a.style.textAlign="start";let b=this.getBackgroundColor();null!==b?a.style.backgroundColor=b:this.hasHeader()&&(a.style.backgroundColor="#f2f3f5")}return{element:a}}exportJSON(){return{...super.exportJSON(),backgroundColor:this.getBackgroundColor(),colSpan:this.__colSpan,headerState:this.__headerState,
rowSpan:this.__rowSpan,type:"tablecell",width:this.getWidth()}}getColSpan(){return this.getLatest().__colSpan}setColSpan(a){let b=this.getWritable();b.__colSpan=a;return b}getRowSpan(){return this.getLatest().__rowSpan}setRowSpan(a){let b=this.getWritable();b.__rowSpan=a;return b}getTag(){return this.hasHeader()?"th":"td"}setHeaderStyles(a,b=x.BOTH){let c=this.getWritable();c.__headerState=a&b|c.__headerState&~b;return c}getHeaderStyles(){return this.getLatest().__headerState}setWidth(a){let b=this.getWritable();
b.__width=a;return b}getWidth(){return this.getLatest().__width}getBackgroundColor(){return this.getLatest().__backgroundColor}setBackgroundColor(a){let b=this.getWritable();b.__backgroundColor=a;return b}toggleHeaderStyle(a){let b=this.getWritable();b.__headerState=(b.__headerState&a)===a?b.__headerState-a:b.__headerState+a;return b}hasHeaderState(a){return(this.getHeaderStyles()&a)===a}hasHeader(){return this.getLatest().__headerState!==x.NO_STATUS}updateDOM(a){return a.__headerState!==this.__headerState||
a.__width!==this.__width||a.__colSpan!==this.__colSpan||a.__rowSpan!==this.__rowSpan||a.__backgroundColor!==this.__backgroundColor}isShadowRoot(){return!0}collapseAtStart(){return!0}canBeEmpty(){return!1}canIndent(){return!1}}
function ca(a){var b=a.nodeName.toLowerCase(),c=void 0;ba.test(a.style.width)&&(c=parseFloat(a.style.width));b=B("th"===b?x.ROW:x.NO_STATUS,a.colSpan,c);b.__rowSpan=a.rowSpan;c=a.style.backgroundColor;""!==c&&(b.__backgroundColor=c);a=a.style;c=(a&&a.textDecoration||"").split(" ");let d="700"===a.fontWeight||"bold"===a.fontWeight,e=c.includes("line-through"),f="italic"===a.fontStyle,g=c.includes("underline");return{after:n=>{0===n.length&&n.push(w.$createParagraphNode());return n},forChild:(n,p)=>
{if(C(p)&&!w.$isElementNode(n)){p=w.$createParagraphNode();if(w.$isLineBreakNode(n)&&"\n"===n.getTextContent())return null;w.$isTextNode(n)&&(d&&n.toggleFormat("bold"),e&&n.toggleFormat("strikethrough"),f&&n.toggleFormat("italic"),g&&n.toggleFormat("underline"));p.append(n);return p}return n},node:b}}function B(a,b=1,c){return w.$applyNodeReplacement(new y(a,b,c))}function C(a){return a instanceof y}let da=w.createCommand("INSERT_TABLE_COMMAND");var D;
function F(a){let b=new URLSearchParams;b.append("code",a);for(let c=1;c<arguments.length;c++)b.append("v",arguments[c]);throw Error(`Minified Lexical error #${a}; visit https://lexical.dev/docs/error?${b} for the full message or `+"use the non-minified dev environment for full errors and additional helpful warnings.");}D=F&&F.__esModule&&Object.prototype.hasOwnProperty.call(F,"default")?F["default"]:F;let ea="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;
class I extends w.ElementNode{static getType(){return"tablerow"}static clone(a){return new I(a.__height,a.__key)}static importDOM(){return{tr:()=>({conversion:fa,priority:0})}}static importJSON(a){return J(a.height)}constructor(a,b){super(b);this.__height=a}exportJSON(){return{...super.exportJSON(),...(this.getHeight()&&{height:this.getHeight()}),type:"tablerow",version:1}}createDOM(a){let b=document.createElement("tr");this.__height&&(b.style.height=`${this.__height}px`);h.addClassNamesToElement(b,
a.theme.tableRow);return b}isShadowRoot(){return!0}setHeight(a){this.getWritable().__height=a;return this.__height}getHeight(){return this.getLatest().__height}updateDOM(a){return a.__height!==this.__height}canBeEmpty(){return!1}canIndent(){return!1}}function fa(a){let b=void 0;ba.test(a.style.height)&&(b=parseFloat(a.style.height));return{node:J(b)}}function J(a){return w.$applyNodeReplacement(new I(a))}function K(a){return a instanceof I}
function ha(a){a=h.$findMatchingParent(a,b=>K(b));if(K(a))return a;throw Error("Expected table cell to be inside of table row.");}function ia(a){a=h.$findMatchingParent(a,b=>M(b));if(M(a))return a;throw Error("Expected table cell to be inside of table.");}function ja(a,b){let c=ia(a),{x:d,y:e}=c.getCordsFromCellNode(a,b);return{above:c.getCellNodeFromCords(d,e-1,b),below:c.getCellNodeFromCords(d,e+1,b),left:c.getCellNodeFromCords(d-1,e,b),right:c.getCellNodeFromCords(d+1,e,b)}}
let ka=(a,b)=>a===x.BOTH||a===b?b:x.NO_STATUS;function N(a){let b=a.getFirstDescendant();null==b?a.selectStart():b.getParentOrThrow().selectStart()}function la(a,b){let c=a.getFirstChild();null!==c?c.insertBefore(b):a.append(b)}function O(a,b,c){let [d,e,f]=ma(a,b,c);null===e&&D(207);null===f&&D(208);return[d,e,f]}
function ma(a,b,c){function d(p){let t=e[p];void 0===t&&(e[p]=t=[]);return t}let e=[],f=null,g=null;a=a.getChildren();for(let p=0;p<a.length;p++){var n=a[p];K(n)||D(209);for(let t=n.getFirstChild(),v=0;null!=t;t=t.getNextSibling()){C(t)||D(147);for(n=d(p);void 0!==n[v];)v++;n={cell:t,startColumn:v,startRow:p};let {__rowSpan:k,__colSpan:l}=t;for(let m=0;m<k&&!(p+m>=a.length);m++){let r=d(p+m);for(let q=0;q<l;q++)r[v+q]=n}null!==b&&null===f&&b.is(t)&&(f=n);null!==c&&null===g&&c.is(t)&&(g=n)}}return[e,
f,g]}function P(a){a instanceof y||("__type"in a?(a=h.$findMatchingParent(a,C),C(a)||D(148)):(a=h.$findMatchingParent(a.getNode(),C),C(a)||D(148)));let b=a.getParent();K(b)||D(149);let c=b.getParent();M(c)||D(210);return[a,b,c]}
function na(a){let [b,,c]=P(a);a=c.getChildren();let d=a.length;var e=a[0].getChildren().length;let f=Array(d);for(var g=0;g<d;g++)f[g]=Array(e);for(e=0;e<d;e++){g=a[e].getChildren();let n=0;for(let p=0;p<g.length;p++){for(;f[e][n];)n++;let t=g[p],v=t.__rowSpan||1,k=t.__colSpan||1;for(let l=0;l<v;l++)for(let m=0;m<k;m++)f[e+l][n+m]=t;if(b===t)return{colSpan:k,columnIndex:n,rowIndex:e,rowSpan:v};n+=k}}return null}
class pa{constructor(a,b,c){this.anchor=b;this.focus=c;b._selection=this;c._selection=this;this._cachedNodes=null;this.dirty=!1;this.tableKey=a}getStartEndPoints(){return[this.anchor,this.focus]}isBackward(){return this.focus.isBefore(this.anchor)}getCachedNodes(){return this._cachedNodes}setCachedNodes(a){this._cachedNodes=a}is(a){return Q(a)?this.tableKey===a.tableKey&&this.anchor.is(a.anchor)&&this.focus.is(a.focus):!1}set(a,b,c){this.dirty=!0;this.tableKey=a;this.anchor.key=b;this.focus.key=c;
this._cachedNodes=null}clone(){return new pa(this.tableKey,this.anchor,this.focus)}isCollapsed(){return!1}extract(){return this.getNodes()}insertRawText(){}insertText(){}hasFormat(a){let b=0;this.getNodes().filter(C).forEach(c=>{c=c.getFirstChild();w.$isParagraphNode(c)&&(b|=c.getTextFormat())});return 0!==(b&w.TEXT_TYPE_TO_FORMAT[a])}insertNodes(a){let b=this.focus.getNode();w.$isElementNode(b)||D(151);w.$normalizeSelection__EXPERIMENTAL(b.select(0,b.getChildrenSize())).insertNodes(a)}getShape(){var a=
w.$getNodeByKey(this.anchor.key);C(a)||D(152);a=na(a);null===a&&D(153);var b=w.$getNodeByKey(this.focus.key);C(b)||D(154);let c=na(b);null===c&&D(155);b=Math.min(a.columnIndex,c.columnIndex);let d=Math.max(a.columnIndex+a.colSpan-1,c.columnIndex+c.colSpan-1),e=Math.min(a.rowIndex,c.rowIndex);a=Math.max(a.rowIndex+a.rowSpan-1,c.rowIndex+c.rowSpan-1);return{fromX:Math.min(b,d),fromY:Math.min(e,a),toX:Math.max(b,d),toY:Math.max(e,a)}}getNodes(){function a(u){let {cell:z,startColumn:A,startRow:E}=u;t=
Math.min(t,A);v=Math.min(v,E);k=Math.max(k,A+z.__colSpan-1);l=Math.max(l,E+z.__rowSpan-1)}var b=this._cachedNodes;if(null!==b)return b;var c=this.anchor.getNode();b=this.focus.getNode();var d=h.$findMatchingParent(c,C);c=h.$findMatchingParent(b,C);C(d)||D(152);C(c)||D(154);b=d.getParent();K(b)||D(156);b=b.getParent();M(b)||D(157);var e=c.getParents()[1];if(e!==b){if(b.isParentOf(c)){var f=e.getParent();null==f&&D(159);this.set(this.tableKey,c.getKey(),f.getKey())}else f=b.getParent(),null==f&&D(158),
this.set(this.tableKey,f.getKey(),c.getKey());return this.getNodes()}let [g,n,p]=O(b,d,c),t=Math.min(n.startColumn,p.startColumn),v=Math.min(n.startRow,p.startRow),k=Math.max(n.startColumn+n.cell.__colSpan-1,p.startColumn+p.cell.__colSpan-1),l=Math.max(n.startRow+n.cell.__rowSpan-1,p.startRow+p.cell.__rowSpan-1);c=t;d=v;e=t;for(var m=v;t<c||v<d||k>e||l>m;){if(t<c){var r=m-d;--c;for(var q=0;q<=r;q++)a(g[d+q][c])}if(v<d)for(r=e-c,--d,q=0;q<=r;q++)a(g[d][c+q]);if(k>e)for(r=m-d,e+=1,q=0;q<=r;q++)a(g[d+
q][e]);if(l>m)for(r=e-c,m+=1,q=0;q<=r;q++)a(g[m][c+q])}b=new Map([[b.getKey(),b]]);c=null;for(d=v;d<=l;d++)for(e=t;e<=k;e++){({cell:m}=g[d][e]);r=m.getParent();K(r)||D(160);r!==c&&b.set(r.getKey(),r);b.set(m.getKey(),m);for(f of qa(m))b.set(f.getKey(),f);c=r}f=Array.from(b.values());w.isCurrentlyReadOnlyMode()||(this._cachedNodes=f);return f}getTextContent(){let a=this.getNodes().filter(c=>C(c)),b="";for(let c=0;c<a.length;c++){let d=a[c],e=d.__parent,f=(a[c+1]||{}).__parent;b+=d.getTextContent()+
(f!==e?"\n":"\t")}return b}}function Q(a){return a instanceof pa}function ra(){let a=w.$createPoint("root",0,"element"),b=w.$createPoint("root",0,"element");return new pa("root",a,b)}function qa(a){let b=[],c=[a];for(;0<c.length;){let d=c.pop();void 0===d&&D(112);w.$isElementNode(d)&&c.unshift(...d.getChildren());d!==a&&b.push(d)}return b}
class sa{constructor(a,b){this.isHighlightingCells=!1;this.focusY=this.focusX=this.anchorY=this.anchorX=-1;this.listenersToRemove=new Set;this.tableNodeKey=b;this.editor=a;this.table={columns:0,domRows:[],rows:0};this.focusCell=this.anchorCell=this.focusCellNodeKey=this.anchorCellNodeKey=this.tableSelection=null;this.hasHijackedSelectionStyles=!1;this.trackTable();this.isSelecting=!1;this.abortController=new AbortController;this.listenerOptions={signal:this.abortController.signal}}getTable(){return this.table}removeListeners(){this.abortController.abort("removeListeners");
Array.from(this.listenersToRemove).forEach(a=>a());this.listenersToRemove.clear()}trackTable(){let a=new MutationObserver(b=>{this.editor.update(()=>{var c=!1;for(let d=0;d<b.length;d++){const e=b[d].target.nodeName;if("TABLE"===e||"TBODY"===e||"THEAD"===e||"TR"===e){c=!0;break}}if(c){c=this.editor.getElementByKey(this.tableNodeKey);if(!c)throw Error("Expected to find TableElement in DOM");this.table=R(c)}})});this.editor.update(()=>{let b=this.editor.getElementByKey(this.tableNodeKey);if(!b)throw Error("Expected to find TableElement in DOM");
this.table=R(b);a.observe(b,{attributes:!0,childList:!0,subtree:!0})})}clearHighlight(){let a=this.editor;this.isHighlightingCells=!1;this.focusY=this.focusX=this.anchorY=this.anchorX=-1;this.focusCell=this.anchorCell=this.focusCellNodeKey=this.anchorCellNodeKey=this.tableSelection=null;this.hasHijackedSelectionStyles=!1;this.enableHighlightStyle();a.update(()=>{var b=w.$getNodeByKey(this.tableNodeKey);if(!M(b))throw Error("Expected TableNode.");b=a.getElementByKey(this.tableNodeKey);if(!b)throw Error("Expected to find TableElement in DOM");
b=R(b);S(a,b,null);w.$setSelection(null);a.dispatchCommand(w.SELECTION_CHANGE_COMMAND,void 0)})}enableHighlightStyle(){let a=this.editor;a.update(()=>{let b=a.getElementByKey(this.tableNodeKey);if(!b)throw Error("Expected to find TableElement in DOM");h.removeClassNamesFromElement(b,a._config.theme.tableSelection);b.classList.remove("disable-selection");this.hasHijackedSelectionStyles=!1})}disableHighlightStyle(){let a=this.editor;a.update(()=>{let b=a.getElementByKey(this.tableNodeKey);if(!b)throw Error("Expected to find TableElement in DOM");
h.addClassNamesToElement(b,a._config.theme.tableSelection);this.hasHijackedSelectionStyles=!0})}updateTableTableSelection(a){if(null!==a&&a.tableKey===this.tableNodeKey){let b=this.editor;this.tableSelection=a;this.isHighlightingCells=!0;this.disableHighlightStyle();S(b,this.table,this.tableSelection)}else null==a?this.clearHighlight():(this.tableNodeKey=a.tableKey,this.updateTableTableSelection(a))}setFocusCellForSelection(a,b=!1){let c=this.editor;c.update(()=>{var d=w.$getNodeByKey(this.tableNodeKey);
if(!M(d))throw Error("Expected TableNode.");if(!c.getElementByKey(this.tableNodeKey))throw Error("Expected to find TableElement in DOM");var e=a.x;let f=a.y;this.focusCell=a;if(null!==this.anchorCell){let g=ea?(c._window||window).getSelection():null;g&&g.setBaseAndExtent(this.anchorCell.elem,0,this.focusCell.elem,0)}if(!this.isHighlightingCells&&(this.anchorX!==e||this.anchorY!==f||b))this.isHighlightingCells=!0,this.disableHighlightStyle();else if(e===this.focusX&&f===this.focusY)return;this.focusX=
e;this.focusY=f;this.isHighlightingCells&&(e=w.$getNearestNodeFromDOMNode(a.elem),null!=this.tableSelection&&null!=this.anchorCellNodeKey&&C(e)&&d.is(T(e))&&(d=e.getKey(),this.tableSelection=this.tableSelection.clone()||ra(),this.focusCellNodeKey=d,this.tableSelection.set(this.tableNodeKey,this.anchorCellNodeKey,this.focusCellNodeKey),w.$setSelection(this.tableSelection),c.dispatchCommand(w.SELECTION_CHANGE_COMMAND,void 0),S(c,this.table,this.tableSelection)))})}setAnchorCellForSelection(a){this.isHighlightingCells=
!1;this.anchorCell=a;this.anchorX=a.x;this.anchorY=a.y;this.editor.update(()=>{var b=w.$getNearestNodeFromDOMNode(a.elem);C(b)&&(b=b.getKey(),this.tableSelection=null!=this.tableSelection?this.tableSelection.clone():ra(),this.anchorCellNodeKey=b)})}formatCells(a){this.editor.update(()=>{let b=w.$getSelection();Q(b)||D(11);let c=w.$createRangeSelection(),d=c.anchor,e=c.focus,f=b.getNodes().filter(C),g=f[0].getFirstChild(),n=w.$isParagraphNode(g)?g.getFormatFlags(a,null):null;f.forEach(p=>{d.set(p.getKey(),
0,"element");e.set(p.getKey(),p.getChildrenSize(),"element");c.formatText(a,n)});w.$setSelection(b);this.editor.dispatchCommand(w.SELECTION_CHANGE_COMMAND,void 0)})}clearText(){let a=this.editor;a.update(()=>{let b=w.$getNodeByKey(this.tableNodeKey);if(!M(b))throw Error("Expected TableNode.");var c=w.$getSelection();Q(c)||D(11);c=c.getNodes().filter(C);c.length===this.table.columns*this.table.rows?(b.selectPrevious(),b.remove(),w.$getRoot().selectStart()):(c.forEach(d=>{if(w.$isElementNode(d)){let e=
w.$createParagraphNode(),f=w.$createTextNode();e.append(f);d.append(e);d.getChildren().forEach(g=>{g!==e&&g.remove()})}}),S(a,this.table,null),w.$setSelection(null),a.dispatchCommand(w.SELECTION_CHANGE_COMMAND,void 0))})}}function ta(a,b){null!==ua(a)&&D(205);a.__lexicalTableSelection=b}function ua(a){return a.__lexicalTableSelection||null}function va(a){for(;null!=a;){let b=a.nodeName;if("TD"===b||"TH"===b){a=a._cell;if(void 0===a)break;return a}a=a.parentNode}return null}
function R(a){let b=[],c={columns:0,domRows:b,rows:0};var d=a.querySelector("tr");let e=a=0;for(b.length=0;null!=d;){var f=d.nodeName;if("TD"===f||"TH"===f){f=d;f={elem:f,hasBackgroundColor:""!==f.style.backgroundColor,highlighted:!1,x:a,y:e};d._cell=f;let g=b[e];void 0===g&&(g=b[e]=[]);g[a]=f}else if(f=d.firstChild,null!=f){d=f;continue}f=d.nextSibling;if(null!=f)a++,d=f;else if(f=d.parentNode,null!=f){d=f.nextSibling;if(null==d)break;e++;a=0}}c.columns=a+1;c.rows=e+1;return c}
function S(a,b,c){let d=new Set(c?c.getNodes():[]);wa(b,(e,f)=>{let g=e.elem;d.has(f)?(e.highlighted=!0,xa(a,e)):(e.highlighted=!1,ya(a,e),g.getAttribute("style")||g.removeAttribute("style"))})}function wa(a,b){({domRows:a}=a);for(let c=0;c<a.length;c++){let d=a[c];if(d)for(let e=0;e<d.length;e++){let f=d[e];if(!f)continue;let g=w.$getNearestNodeFromDOMNode(f.elem);null!==g&&b(f,g,{x:e,y:c})}}}function za(a,b){b.disableHighlightStyle();wa(b.table,c=>{c.highlighted=!0;xa(a,c)})}
function Aa(a,b){b.enableHighlightStyle();wa(b.table,c=>{let d=c.elem;c.highlighted=!1;ya(a,c);d.getAttribute("style")||d.removeAttribute("style")})}
let Ba=(a,b,c,d,e)=>{const f="forward"===e;switch(e){case "backward":case "forward":return c!==(f?a.table.columns-1:0)?(a=b.getCellNodeFromCordsOrThrow(c+(f?1:-1),d,a.table),f?a.selectStart():a.selectEnd()):d!==(f?a.table.rows-1:0)?(a=b.getCellNodeFromCordsOrThrow(f?0:a.table.columns-1,d+(f?1:-1),a.table),f?a.selectStart():a.selectEnd()):f?b.selectNext():b.selectPrevious(),!0;case "up":return 0!==d?b.getCellNodeFromCordsOrThrow(c,d-1,a.table).selectEnd():b.selectPrevious(),!0;case "down":return d!==
a.table.rows-1?b.getCellNodeFromCordsOrThrow(c,d+1,a.table).selectStart():b.selectNext(),!0;default:return!1}},Ca=(a,b,c,d,e)=>{const f="forward"===e;switch(e){case "backward":case "forward":return c!==(f?a.table.columns-1:0)&&a.setFocusCellForSelection(b.getDOMCellFromCordsOrThrow(c+(f?1:-1),d,a.table)),!0;case "up":return 0!==d?(a.setFocusCellForSelection(b.getDOMCellFromCordsOrThrow(c,d-1,a.table)),!0):!1;case "down":return d!==a.table.rows-1?(a.setFocusCellForSelection(b.getDOMCellFromCordsOrThrow(c,
d+1,a.table)),!0):!1;default:return!1}};function U(a,b){if(w.$isRangeSelection(a)||Q(a)){let c=b.isParentOf(a.anchor.getNode());a=b.isParentOf(a.focus.getNode());return c&&a}return!1}
function xa(a,b){a=b.elem;b=w.$getNearestNodeFromDOMNode(a);C(b)||D(131);null===b.getBackgroundColor()?a.style.setProperty("background-color","rgb(172,206,247)"):a.style.setProperty("background-image","linear-gradient(to right, rgba(172,206,247,0.85), rgba(172,206,247,0.85))");a.style.setProperty("caret-color","transparent")}
function ya(a,b){a=b.elem;b=w.$getNearestNodeFromDOMNode(a);C(b)||D(131);null===b.getBackgroundColor()&&a.style.removeProperty("background-color");a.style.removeProperty("background-image");a.style.removeProperty("caret-color")}function X(a){a=h.$findMatchingParent(a,C);return C(a)?a:null}function T(a){a=h.$findMatchingParent(a,M);return M(a)?a:null}
function Y(a,b,c,d,e){if(("up"===c||"down"===c)&&Ea(a))return!1;var f=w.$getSelection();if(!U(f,d)){if(w.$isRangeSelection(f)){if(f.isCollapsed()&&"backward"===c){c=f.anchor.type;d=f.anchor.offset;if("element"!==c&&("text"!==c||0!==d))return!1;c=f.anchor.getNode();if(!c)return!1;c=h.$findMatchingParent(c,t=>w.$isElementNode(t)&&!t.isInline());if(!c)return!1;c=c.getPreviousSibling();if(!c||!M(c))return!1;Z(b);c.selectEnd();return!0}if(b.shiftKey&&("up"===c||"down"===c)){a=f.focus.getNode();if(!f.isCollapsed()&&
("up"===c&&!f.isBackward()||"down"===c&&f.isBackward())){e=h.$findMatchingParent(a,t=>M(t));C(e)&&(e=h.$findMatchingParent(e,M));if(e!==d||!e)return!1;d="down"===c?e.getNextSibling():e.getPreviousSibling();if(!d)return!1;e=0;"up"===c&&w.$isElementNode(d)&&(e=d.getChildrenSize());a=d;"up"===c&&w.$isElementNode(d)&&(a=(c=d.getLastChild())?c:d,e=w.$isTextNode(a)?a.getTextContentSize():0);c=f.clone();c.focus.set(a.getKey(),e,w.$isTextNode(a)?"text":"element");w.$setSelection(c);Z(b);return!0}if(w.$isRootOrShadowRoot(a)){if((b=
"up"===c?f.getNodes()[f.getNodes().length-1]:f.getNodes()[0])&&(b=h.$findMatchingParent(b,C))&&d.isParentOf(b)){c=d.getFirstDescendant();b=d.getLastDescendant();if(!c||!b)return!1;[c]=P(c);[b]=P(b);c=d.getCordsFromCellNode(c,e.table);b=d.getCordsFromCellNode(b,e.table);c=d.getDOMCellFromCordsOrThrow(c.x,c.y,e.table);b=d.getDOMCellFromCordsOrThrow(b.x,b.y,e.table);e.setAnchorCellForSelection(c);e.setFocusCellForSelection(b,!0);return!0}}else{d=h.$findMatchingParent(a,t=>w.$isElementNode(t)&&!t.isInline());
C(d)&&(d=h.$findMatchingParent(d,M));if(!d)return!1;d="down"===c?d.getNextSibling():d.getPreviousSibling();if(M(d)&&e.tableNodeKey===d.getKey()){e=d.getFirstDescendant();a=d.getLastDescendant();if(!e||!a)return!1;[d]=P(e);[e]=P(a);f=f.clone();f.focus.set(("up"===c?d:e).getKey(),"up"===c?0:e.getChildrenSize(),"element");Z(b);w.$setSelection(f);return!0}}}}return!1}if(w.$isRangeSelection(f)&&f.isCollapsed()){let {anchor:t,focus:v}=f;var g=h.$findMatchingParent(t.getNode(),C),n=h.$findMatchingParent(v.getNode(),
C);if(!C(g)||!g.is(n))return!1;n=T(g);if(n!==d&&null!=n){var p=a.getElementByKey(n.getKey());if(null!=p)return e.table=R(p),Y(a,b,c,n,e)}if("backward"===c||"forward"===c){e=t.type;a=t.offset;g=t.getNode();if(!g)return!1;f=f.getNodes();return 1===f.length&&w.$isDecoratorNode(f[0])?!1:Fa(e,a,g,c)?Ga(b,g,d,c):!1}f=a.getElementByKey(g.__key);n=a.getElementByKey(t.key);if(null==n||null==f)return!1;if("element"===t.type)f=n.getBoundingClientRect();else{f=window.getSelection();if(null===f||0===f.rangeCount)return!1;
f=f.getRangeAt(0).getBoundingClientRect()}n="up"===c?g.getFirstChild():g.getLastChild();if(null==n)return!1;a=a.getElementByKey(n.__key);if(null==a)return!1;a=a.getBoundingClientRect();if("up"===c?a.top>f.top-f.height:f.bottom+f.height>a.bottom){Z(b);f=d.getCordsFromCellNode(g,e.table);if(b.shiftKey)b=d.getDOMCellFromCordsOrThrow(f.x,f.y,e.table),e.setAnchorCellForSelection(b),e.setFocusCellForSelection(b,!0);else return Ba(e,d,f.x,f.y,c);return!0}}else if(Q(f)){let {anchor:t,focus:v}=f;p=h.$findMatchingParent(t.getNode(),
C);n=h.$findMatchingParent(v.getNode(),C);[g]=f.getNodes();a=a.getElementByKey(g.getKey());if(!C(p)||!C(n)||!M(g)||null==a)return!1;e.updateTableTableSelection(f);f=R(a);a=d.getCordsFromCellNode(p,f);a=d.getDOMCellFromCordsOrThrow(a.x,a.y,f);e.setAnchorCellForSelection(a);Z(b);if(b.shiftKey)return b=d.getCordsFromCellNode(n,f),Ca(e,g,b.x,b.y,c);n.selectEnd();return!0}return!1}function Z(a){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation()}
function Ea(a){return(a=a.getRootElement())?a.hasAttribute("aria-controls")&&"typeahead-menu"===a.getAttribute("aria-controls"):!1}function Fa(a,b,c,d){return"element"===a&&("backward"===d?null===c.getPreviousSibling():null===c.getNextSibling())||Ha(a,b,c,d)}
function Ha(a,b,c,d){let e=h.$findMatchingParent(c,f=>w.$isElementNode(f)&&!f.isInline());if(!e)return!1;b="backward"===d?0===b:b===c.getTextContentSize();return"text"===a&&b&&("backward"===d?null===e.getPreviousSibling():null===e.getNextSibling())}
function Ga(a,b,c,d){var e=h.$findMatchingParent(b,C);if(!C(e))return!1;let [f,g]=O(c,e,e);e=f[0][0];let n=f[f.length-1][f[0].length-1],{startColumn:p,startRow:t}=g;if("backward"===d?p!==e.startColumn||t!==e.startRow:p!==n.startColumn||t!==n.startRow)return!1;b=Ia(b,d,c);if(!b||M(b))return!1;Z(a);"backward"===d?b.selectEnd():b.selectStart();return!0}
function Ia(a,b,c){if(a=h.$findMatchingParent(a,d=>w.$isElementNode(d)&&!d.isInline()))return(a="backward"===b?a.getPreviousSibling():a.getNextSibling())&&M(a)?a:"backward"===b?c.getPreviousSibling():c.getNextSibling()}function Ja(a,b,c){let d=w.$createParagraphNode();"first"===a?b.insertBefore(d):b.insertAfter(d);d.append(...(c||[]));d.selectEnd()}
function Ka(a,b,c){var d=c.getParent();if(d&&(a=a.getElementByKey(d.getKey()))&&(d=window.getSelection())&&d.anchorNode===a&&(b=h.$findMatchingParent(b.anchor.getNode(),p=>C(p)))&&(a=h.$findMatchingParent(b,p=>M(p)),M(a)&&a.is(c))){var [e,f]=O(c,b,b);c=e[0][0];b=e[e.length-1][e[0].length-1];var {startRow:g,startColumn:n}=f;if(g===c.startRow&&n===c.startColumn)return"first";if(g===b.startRow&&n===b.startColumn)return"last"}}
function La(a,b,c,d){if(a=a.querySelector("colgroup")){b=[];for(let e=0;e<c;e++){let f=document.createElement("col"),g=d&&d[e];g&&(f.style.width=`${g}px`);b.push(f)}a.replaceChildren(...b)}}function Ma(a,b,c){c?(h.addClassNamesToElement(a,b.theme.tableRowStriping),a.setAttribute("data-lexical-row-striping","true")):(h.removeClassNamesFromElement(a,b.theme.tableRowStriping),a.removeAttribute("data-lexical-row-striping"))}
class Na extends w.ElementNode{static getType(){return"table"}getColWidths(){return this.getLatest().__colWidths}setColWidths(a){let b=this.getWritable();b.__colWidths=a;return b}static clone(a){return new Na(a.__key)}afterCloneFrom(a){super.afterCloneFrom(a);this.__colWidths=a.__colWidths;this.__rowStriping=a.__rowStriping}static importDOM(){return{table:()=>({conversion:Oa,priority:1})}}static importJSON(a){let b=Pa();b.__rowStriping=a.rowStriping||!1;b.__colWidths=a.colWidths;return b}constructor(a){super(a);
this.__rowStriping=!1}exportJSON(){return{...super.exportJSON(),colWidths:this.getColWidths(),rowStriping:this.__rowStriping?this.__rowStriping:void 0,type:"table",version:1}}createDOM(a){let b=document.createElement("table"),c=document.createElement("colgroup");b.appendChild(c);La(b,a,this.getColumnCount(),this.getColWidths());h.addClassNamesToElement(b,a.theme.table);this.__rowStriping&&Ma(b,a,!0);return b}updateDOM(a,b,c){a.__rowStriping!==this.__rowStriping&&Ma(b,c,this.__rowStriping);La(b,c,
this.getColumnCount(),this.getColWidths());return!1}exportDOM(a){return{...super.exportDOM(a),after:b=>{if(b){let c=b.cloneNode(),d=document.createElement("colgroup"),e=document.createElement("tbody");if(h.isHTMLElement(b)){let f=b.querySelectorAll("col");d.append(...f);b=b.querySelectorAll("tr");e.append(...b)}c.replaceChildren(d,e);return c}}}}canBeEmpty(){return!1}isShadowRoot(){return!0}getCordsFromCellNode(a,b){let {rows:c,domRows:d}=b;for(b=0;b<c;b++){var e=d[b];if(null!=e&&(e=e.findIndex(f=>
{if(f)return{elem:f}=f,w.$getNearestNodeFromDOMNode(f)===a}),-1!==e))return{x:e,y:b}}throw Error("Cell not found in table.");}getDOMCellFromCords(a,b,c){({domRows:c}=c);b=c[b];if(null==b)return null;a=b[a<b.length?a:b.length-1];return null==a?null:a}getDOMCellFromCordsOrThrow(a,b,c){a=this.getDOMCellFromCords(a,b,c);if(!a)throw Error("Cell not found at cords.");return a}getCellNodeFromCords(a,b,c){a=this.getDOMCellFromCords(a,b,c);if(null==a)return null;a=w.$getNearestNodeFromDOMNode(a.elem);return C(a)?
a:null}getCellNodeFromCordsOrThrow(a,b,c){a=this.getCellNodeFromCords(a,b,c);if(!a)throw Error("Node at cords not TableCellNode.");return a}getRowStriping(){return!!this.getLatest().__rowStriping}setRowStriping(a){this.getWritable().__rowStriping=a}canSelectBefore(){return!0}canIndent(){return!1}getColumnCount(){let a=this.getFirstChild();if(!a)return 0;let b=0;a.getChildren().forEach(c=>{C(c)&&(b+=c.getColSpan())});return b}}
function Oa(a){let b=Pa();a.hasAttribute("data-lexical-row-striping")&&b.setRowStriping(!0);var c=a.querySelector(":scope > colgroup");if(c){a=[];for(let d of c.querySelectorAll(":scope > col")){c=d.style.width;if(!c||!ba.test(c)){a=void 0;break}a.push(parseFloat(c))}a&&b.setColWidths(a)}return{node:b}}function Pa(){return w.$applyNodeReplacement(new Na)}function M(a){return a instanceof Na}exports.$computeTableMap=O;exports.$computeTableMapSkipCellCheck=ma;exports.$createTableCellNode=B;
exports.$createTableNode=Pa;exports.$createTableNodeWithDimensions=function(a,b,c=!0){let d=Pa();for(let f=0;f<a;f++){let g=J();for(let n=0;n<b;n++){var e=x.NO_STATUS;"object"===typeof c?(0===f&&c.rows&&(e|=x.ROW),0===n&&c.columns&&(e|=x.COLUMN)):c&&(0===f&&(e|=x.ROW),0===n&&(e|=x.COLUMN));e=B(e);let p=w.$createParagraphNode();p.append(w.$createTextNode());e.append(p);g.append(e)}d.append(g)}return d};exports.$createTableRowNode=J;exports.$createTableSelection=ra;
exports.$deleteTableColumn=function(a,b){let c=a.getChildren();for(let e=0;e<c.length;e++){var d=c[e];if(K(d)){d=d.getChildren();if(b>=d.length||0>b)throw Error("Table column target index out of range");d[b].remove()}}return a};
exports.$deleteTableColumn__EXPERIMENTAL=function(){var a=w.$getSelection();w.$isRangeSelection(a)||Q(a)||D(188);var b=a.anchor.getNode();a=a.focus.getNode();let [c,,d]=P(b);var [e]=P(a);let [f,g,n]=O(d,c,e);var {startColumn:p}=g;let {startRow:t,startColumn:v}=n;b=Math.min(p,v);var k=Math.max(p+c.__colSpan-1,v+e.__colSpan-1);a=k-b+1;if(f[0].length===k-b+1)d.selectPrevious(),d.remove();else{var l=f.length;for(let m=0;m<l;m++)for(let r=b;r<=k;r++){let {cell:q,startColumn:u}=f[m][r];u<b?r===b&&q.setColSpan(q.__colSpan-
Math.min(a,q.__colSpan-(b-u))):u+q.__colSpan-1>k?r===k&&q.setColSpan(q.__colSpan-(k-u+1)):q.remove()}k=f[t];e=p>v?k[p+c.__colSpan]:k[v+e.__colSpan];void 0!==e?({cell:p}=e,N(p)):({cell:p}=v<p?k[v-1]:k[p-1],N(p));if(p=d.getColWidths())p=[...p],p.splice(b,a),d.setColWidths(p)}};
exports.$deleteTableRow__EXPERIMENTAL=function(){var a=w.$getSelection();w.$isRangeSelection(a)||Q(a)||D(188);let [b,c]=a.isBackward()?[a.focus.getNode(),a.anchor.getNode()]:[a.anchor.getNode(),a.focus.getNode()],[d,,e]=P(b);var [f]=P(c);let [g,n,p]=O(e,d,f);({startRow:a}=n);var {startRow:t}=p;f=t+f.__rowSpan-1;if(g.length===f-a+1)e.remove();else{t=g[0].length;var v=g[f+1],k=e.getChildAtIndex(f+1);for(let m=f;m>=a;m--){for(var l=t-1;0<=l;l--){let {cell:r,startRow:q,startColumn:u}=g[m][l];if(u===l&&
(m===a&&q<a&&r.setRowSpan(r.__rowSpan-(q-a)),q>=a&&q+r.__rowSpan-1>f))if(r.setRowSpan(r.__rowSpan-(f-q+1)),null===k&&D(122),0===l)la(k,r);else{let {cell:z}=v[l-1];z.insertAfter(r)}}l=e.getChildAtIndex(m);K(l)||D(206,String(m));l.remove()}void 0!==v?({cell:a}=v[0],N(a)):({cell:a}=g[a-1][0],N(a))}};exports.$findCellNode=X;exports.$findTableNode=T;exports.$getElementForTableNode=function(a,b){a=a.getElementByKey(b.getKey());if(null==a)throw Error("Table Element Not Found");return R(a)};
exports.$getNodeTriplet=P;exports.$getTableCellNodeFromLexicalNode=function(a){a=h.$findMatchingParent(a,b=>C(b));return C(a)?a:null};exports.$getTableCellNodeRect=na;exports.$getTableColumnIndexFromTableCellNode=function(a){return ha(a).getChildren().findIndex(b=>b.is(a))};exports.$getTableNodeFromLexicalNodeOrThrow=ia;exports.$getTableRowIndexFromTableCellNode=function(a){let b=ha(a);return ia(b).getChildren().findIndex(c=>c.is(b))};exports.$getTableRowNodeFromTableCellNodeOrThrow=ha;
exports.$insertTableColumn=function(a,b,c=!0,d,e){let f=a.getChildren(),g=[];for(let t=0;t<f.length;t++){let v=f[t];if(K(v))for(let k=0;k<d;k++){var n=v.getChildren();if(b>=n.length||0>b)throw Error("Table column target index out of range");n=n[b];C(n)||D(12);let {left:l,right:m}=ja(n,e);var p=x.NO_STATUS;if(l&&l.hasHeaderState(x.ROW)||m&&m.hasHeaderState(x.ROW))p|=x.ROW;p=B(p);p.append(w.$createParagraphNode());g.push({newTableCell:p,targetCell:n})}}g.forEach(({newTableCell:t,targetCell:v})=>{c?
v.insertAfter(t):v.insertBefore(t)});return a};
exports.$insertTableColumn__EXPERIMENTAL=function(a=!0){function b(k=x.NO_STATUS){k=B(k).append(w.$createParagraphNode());null===t&&(t=k);return k}var c=w.$getSelection();w.$isRangeSelection(c)||Q(c)||D(188);var d=c.anchor.getNode();c=c.focus.getNode();[d]=P(d);let [e,,f]=P(c),[g,n,p]=O(f,e,d);d=g.length;c=a?Math.max(n.startColumn,p.startColumn):Math.min(n.startColumn,p.startColumn);a=a?c+e.__colSpan-1:c-1;c=f.getFirstChild();K(c)||D(120);let t=null;var v=c;a:for(c=0;c<d;c++){0!==c&&(v=v.getNextSibling(),
K(v)||D(121));let k=g[c],l=ka(k[0>a?0:a].cell.__headerState,x.ROW);if(0>a){la(v,b(l));continue}let {cell:m,startColumn:r,startRow:q}=k[a];if(r+m.__colSpan-1<=a){let u=m,z=q,A=a;for(;z!==c&&1<u.__rowSpan;)if(A-=m.__colSpan,0<=A){let {cell:E,startRow:G}=k[A];u=E;z=G}else{v.append(b(l));continue a}u.insertAfter(b(l))}else m.setColSpan(m.__colSpan+1)}null!==t&&N(t);if(d=f.getColWidths())d=[...d],a=0>a?0:a,d.splice(a,0,d[a]),f.setColWidths(d);return t};
exports.$insertTableRow=function(a,b,c=!0,d,e){var f=a.getChildren();if(b>=f.length||0>b)throw Error("Table row target index out of range");b=f[b];if(K(b))for(f=0;f<d;f++){let n=b.getChildren(),p=n.length,t=J();for(let v=0;v<p;v++){var g=n[v];C(g)||D(12);let {above:k,below:l}=ja(g,e);g=x.NO_STATUS;let m=k&&k.getWidth()||l&&l.getWidth()||void 0;if(k&&k.hasHeaderState(x.COLUMN)||l&&l.hasHeaderState(x.COLUMN))g|=x.COLUMN;g=B(g,1,m);g.append(w.$createParagraphNode());t.append(g)}c?b.insertAfter(t):b.insertBefore(t)}else throw Error("Row before insertion index does not exist.");
return a};
exports.$insertTableRow__EXPERIMENTAL=function(a=!0){var b=w.$getSelection();w.$isRangeSelection(b)||Q(b)||D(188);b=b.focus.getNode();let [c,,d]=P(b),[e,f]=O(d,c,c);b=e[0].length;var {startRow:g}=f;if(a){a=g+c.__rowSpan-1;var n=e[a];g=J();for(var p=0;p<b;p++){let {cell:v,startRow:k}=n[p];if(k+v.__rowSpan-1<=a){var t=ka(n[p].cell.__headerState,x.COLUMN);g.append(B(t).append(w.$createParagraphNode()))}else v.setRowSpan(v.__rowSpan+1)}b=d.getChildAtIndex(a);K(b)||D(145);b.insertAfter(g);b=g}else{n=e[g];
a=J();for(p=0;p<b;p++){let {cell:v,startRow:k}=n[p];k===g?(t=ka(n[p].cell.__headerState,x.COLUMN),a.append(B(t).append(w.$createParagraphNode()))):v.setRowSpan(v.__rowSpan+1)}b=d.getChildAtIndex(g);K(b)||D(145);b.insertBefore(a);b=a}return b};exports.$isTableCellNode=C;exports.$isTableNode=M;exports.$isTableRowNode=K;exports.$isTableSelection=Q;
exports.$removeTableRowAtIndex=function(a,b){let c=a.getChildren();if(b>=c.length||0>b)throw Error("Expected table cell to be inside of table row.");c[b].remove();return a};
exports.$unmergeCell=function(){var a=w.$getSelection();w.$isRangeSelection(a)||Q(a)||D(188);a=a.anchor.getNode();let [b,c,d]=P(a);a=b.__colSpan;let e=b.__rowSpan;if(1!==a||1!==e){var [f,g]=O(d,b,b),{startColumn:n,startRow:p}=g,t=b.__headerState&x.COLUMN,v=Array.from({length:a},(u,z)=>{u=t;for(let A=0;0!==u&&A<f.length;A++)u&=f[A][z+n].cell.__headerState;return u}),k=b.__headerState&x.ROW,l=Array.from({length:e},(u,z)=>{u=k;for(let A=0;0!==u&&A<f[0].length;A++)u&=f[z+p][A].cell.__headerState;return u});
if(1<a){for(var m=1;m<a;m++)b.insertAfter(B(v[m]|l[0]).append(w.$createParagraphNode()));b.setColSpan(1)}if(1<e){let u;for(m=1;m<e;m++){var r=p+m;let z=f[r];u=(u||c).getNextSibling();K(u)||D(125);var q=null;for(let A=0;A<n;A++){let E=z[A],G=E.cell;E.startRow===r&&(q=G);1<G.__colSpan&&(A+=G.__colSpan-1)}if(null===q)for(q=a-1;0<=q;q--)la(u,B(v[q]|l[m]).append(w.$createParagraphNode()));else for(r=a-1;0<=r;r--)q.insertAfter(B(v[r]|l[m]).append(w.$createParagraphNode()))}b.setRowSpan(1)}}};
exports.INSERT_TABLE_COMMAND=da;exports.TableCellHeaderStates=x;exports.TableCellNode=y;exports.TableNode=Na;exports.TableObserver=sa;exports.TableRowNode=I;
exports.applyTableHandlers=function(a,b,c,d){function e(k){k=a.getCordsFromCellNode(k,g.table);return a.getDOMCellFromCordsOrThrow(k.x,k.y,g.table)}let f=c.getRootElement();if(null===f)throw Error("No root element.");let g=new sa(c,a.getKey()),n=c._window||window;ta(b,g);g.listenersToRemove.add(()=>{var k=g;ua(b)===k&&delete b.__lexicalTableSelection});let p=()=>{const k=()=>{g.isSelecting=!1;n.removeEventListener("mouseup",k);n.removeEventListener("mousemove",l)},l=m=>{setTimeout(()=>{if(1!==(m.buttons&
1)&&g.isSelecting)g.isSelecting=!1,n.removeEventListener("mouseup",k),n.removeEventListener("mousemove",l);else{var r=va(m.target);null===r||g.anchorX===r.x&&g.anchorY===r.y||(m.preventDefault(),g.setFocusCellForSelection(r))}},0)};return{onMouseMove:l,onMouseUp:k}};b.addEventListener("mousedown",k=>{setTimeout(()=>{if(0===k.button&&n){var l=va(k.target);null!==l&&(Z(k),g.setAnchorCellForSelection(l));var {onMouseUp:m,onMouseMove:r}=p();g.isSelecting=!0;n.addEventListener("mouseup",m,g.listenerOptions);
n.addEventListener("mousemove",r,g.listenerOptions)}},0)},g.listenerOptions);n.addEventListener("mousedown",k=>{0===k.button&&c.update(()=>{const l=w.$getSelection(),m=k.target;Q(l)&&l.tableKey===g.tableNodeKey&&f.contains(m)&&g.clearHighlight()})},g.listenerOptions);g.listenersToRemove.add(c.registerCommand(w.KEY_ARROW_DOWN_COMMAND,k=>Y(c,k,"down",a,g),w.COMMAND_PRIORITY_HIGH));g.listenersToRemove.add(c.registerCommand(w.KEY_ARROW_UP_COMMAND,k=>Y(c,k,"up",a,g),w.COMMAND_PRIORITY_HIGH));g.listenersToRemove.add(c.registerCommand(w.KEY_ARROW_LEFT_COMMAND,
k=>Y(c,k,"backward",a,g),w.COMMAND_PRIORITY_HIGH));g.listenersToRemove.add(c.registerCommand(w.KEY_ARROW_RIGHT_COMMAND,k=>Y(c,k,"forward",a,g),w.COMMAND_PRIORITY_HIGH));g.listenersToRemove.add(c.registerCommand(w.KEY_ESCAPE_COMMAND,k=>{var l=w.$getSelection();return Q(l)&&(l=h.$findMatchingParent(l.focus.getNode(),C),C(l))?(Z(k),l.selectEnd(),!0):!1},w.COMMAND_PRIORITY_HIGH));let t=k=>()=>{var l=w.$getSelection();if(!U(l,a))return!1;if(Q(l))return g.clearText(),!0;if(w.$isRangeSelection(l)){var m=
h.$findMatchingParent(l.anchor.getNode(),q=>C(q));if(!C(m))return!1;var r=l.anchor.getNode();m=l.focus.getNode();r=a.isParentOf(r);m=a.isParentOf(m);if(r&&!m||m&&!r)return g.clearText(),!0;m=(l=h.$findMatchingParent(l.anchor.getNode(),q=>w.$isElementNode(q)))&&h.$findMatchingParent(l,q=>w.$isElementNode(q)&&C(q.getParent()));if(!w.$isElementNode(m)||!w.$isElementNode(l))return!1;if(k===w.DELETE_LINE_COMMAND&&null===m.getPreviousSibling())return!0}return!1};[w.DELETE_WORD_COMMAND,w.DELETE_LINE_COMMAND,
w.DELETE_CHARACTER_COMMAND].forEach(k=>{g.listenersToRemove.add(c.registerCommand(k,t(k),w.COMMAND_PRIORITY_CRITICAL))});let v=k=>{const l=w.$getSelection();if(!Q(l)&&!w.$isRangeSelection(l))return!1;const m=a.isParentOf(l.anchor.getNode()),r=a.isParentOf(l.focus.getNode());if(m!==r){k=m?"focus":"anchor";const {key:q,offset:u,type:z}=l[k];a[l[m?"anchor":"focus"].isBefore(l[k])?"selectPrevious":"selectNext"]()[k].set(q,u,z);return!1}return Q(l)?(k&&(k.preventDefault(),k.stopPropagation()),g.clearText(),
!0):!1};g.listenersToRemove.add(c.registerCommand(w.KEY_BACKSPACE_COMMAND,v,w.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(w.KEY_DELETE_COMMAND,v,w.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(w.CUT_COMMAND,k=>{let l=w.$getSelection();if(l){if(!Q(l)&&!w.$isRangeSelection(l))return!1;void aa.copyToClipboard(c,h.objectKlassEquals(k,ClipboardEvent)?k:null,aa.$getClipboardDataFromSelection(l));k=v(k);return w.$isRangeSelection(l)?(l.removeText(),!0):k}return!1},
w.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(w.FORMAT_TEXT_COMMAND,k=>{let l=w.$getSelection();if(!U(l,a))return!1;if(Q(l))return g.formatCells(k),!0;w.$isRangeSelection(l)&&(k=h.$findMatchingParent(l.anchor.getNode(),m=>C(m)),C(k));return!1},w.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(w.FORMAT_ELEMENT_COMMAND,k=>{var l=w.$getSelection();if(!Q(l)||!U(l,a))return!1;var m=l.anchor.getNode();l=l.focus.getNode();if(!C(m)||!C(l))return!1;let [r,q,
u]=O(a,m,l);m=Math.max(q.startRow,u.startRow);l=Math.max(q.startColumn,u.startColumn);var z=Math.min(q.startRow,u.startRow);let A=Math.min(q.startColumn,u.startColumn);for(;z<=m;z++)for(let G=A;G<=l;G++){var E=r[z][G].cell;E.setFormat(k);E=E.getChildren();for(let L=0;L<E.length;L++){let H=E[L];w.$isElementNode(H)&&!H.isInline()&&H.setFormat(k)}}return!0},w.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(w.CONTROLLED_TEXT_INSERTION_COMMAND,k=>{var l=w.$getSelection();if(!U(l,
a))return!1;if(Q(l))g.clearHighlight();else if(w.$isRangeSelection(l)){let m=h.$findMatchingParent(l.anchor.getNode(),r=>C(r));if(!C(m))return!1;if("string"===typeof k&&(l=Ka(c,l,a)))return Ja(l,a,[w.$createTextNode(k)]),!0}return!1},w.COMMAND_PRIORITY_CRITICAL));d&&g.listenersToRemove.add(c.registerCommand(w.KEY_TAB_COMMAND,k=>{var l=w.$getSelection();if(!w.$isRangeSelection(l)||!l.isCollapsed()||!U(l,a))return!1;l=X(l.anchor.getNode());if(null===l)return!1;Z(k);l=a.getCordsFromCellNode(l,g.table);
Ba(g,a,l.x,l.y,k.shiftKey?"backward":"forward");return!0},w.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(w.FOCUS_COMMAND,()=>a.isSelected(),w.COMMAND_PRIORITY_HIGH));g.listenersToRemove.add(c.registerCommand(w.SELECTION_INSERT_CLIPBOARD_NODES_COMMAND,k=>{let {nodes:l,selection:m}=k;k=m.getStartEndPoints();var r=Q(m);r=w.$isRangeSelection(m)&&null!==h.$findMatchingParent(m.anchor.getNode(),H=>C(H))&&null!==h.$findMatchingParent(m.focus.getNode(),H=>C(H))||r;if(1!==l.length||
!M(l[0])||!r||null===k)return!1;var [q]=k,u=l[0];k=u.getChildren();r=u.getFirstChildOrThrow().getChildrenSize();u=u.getChildrenSize();var z=h.$findMatchingParent(q.getNode(),H=>C(H)),A=z&&h.$findMatchingParent(z,H=>K(H)),E=A&&h.$findMatchingParent(A,H=>M(H));if(!C(z)||!K(A)||!M(E))return!1;q=A.getIndexWithinParent();var G=Math.min(E.getChildrenSize()-1,q+u-1);u=z.getIndexWithinParent();z=Math.min(A.getChildrenSize()-1,u+r-1);r=Math.min(u,z);A=Math.min(q,G);u=Math.max(u,z);q=Math.max(q,G);E=E.getChildren();
for(G=0;A<=q;A++){z=E[A];if(!K(z))return!1;var L=k[G];if(!K(L))return!1;z=z.getChildren();L=L.getChildren();let H=0;for(let V=r;V<=u;V++){let oa=z[V];if(!C(oa))return!1;let Da=L[H];if(!C(Da))return!1;let Qa=oa.getChildren();Da.getChildren().forEach(W=>{w.$isTextNode(W)&&w.$createParagraphNode().append(W);oa.append(W)});Qa.forEach(W=>W.remove());H++}G++}return!0},w.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(w.SELECTION_CHANGE_COMMAND,()=>{let k=w.$getSelection(),l=w.$getPreviousSelection();
if(w.$isRangeSelection(k)){let {anchor:z,focus:A}=k;var m=z.getNode(),r=A.getNode(),q=X(m),u=X(r);let E=!(!q||!a.is(T(q))),G=!(!u||!a.is(T(u)));m=E!==G;let L=E&&G;r=k.isBackward();m?(m=k.clone(),G?([u]=O(a,u,u),q=u[0][0].cell,u=u[u.length-1].at(-1).cell,m.focus.set(r?q.getKey():u.getKey(),r?q.getChildrenSize():u.getChildrenSize(),"element")):E&&([u]=O(a,q,q),q=u[0][0].cell,u=u[u.length-1].at(-1).cell,m.anchor.set(r?u.getKey():q.getKey(),r?u.getChildrenSize():0,"element")),w.$setSelection(m),za(c,
g)):L&&!q.is(u)&&(g.setAnchorCellForSelection(e(q)),g.setFocusCellForSelection(e(u),!0),g.isSelecting||setTimeout(()=>{let {onMouseUp:H,onMouseMove:V}=p();g.isSelecting=!0;n.addEventListener("mouseup",H);n.addEventListener("mousemove",V)},0))}else k&&Q(k)&&k.is(l)&&k.tableKey===a.getKey()&&(r=ea?(c._window||window).getSelection():null)&&r.anchorNode&&r.focusNode&&(m=(m=w.$getNearestNodeFromDOMNode(r.focusNode))&&!a.is(T(m)),q=(q=w.$getNearestNodeFromDOMNode(r.anchorNode))&&a.is(T(q)),m&&q&&0<r.rangeCount&&
(m=w.$createRangeSelectionFromDom(r,c)))&&(m.anchor.set(a.getKey(),k.isBackward()?a.getChildrenSize():0,"element"),r.removeAllRanges(),w.$setSelection(m));if(k&&!k.is(l)&&(Q(k)||Q(l))&&g.tableSelection&&!g.tableSelection.is(l))return Q(k)&&k.tableKey===g.tableNodeKey?g.updateTableTableSelection(k):!Q(k)&&Q(l)&&l.tableKey===g.tableNodeKey&&g.updateTableTableSelection(null),!1;g.hasHijackedSelectionStyles&&!a.isSelected()?Aa(c,g):!g.hasHijackedSelectionStyles&&a.isSelected()&&za(c,g);return!1},w.COMMAND_PRIORITY_CRITICAL));
g.listenersToRemove.add(c.registerCommand(w.INSERT_PARAGRAPH_COMMAND,()=>{var k=w.$getSelection();return w.$isRangeSelection(k)&&k.isCollapsed()&&U(k,a)?(k=Ka(c,k,a))?(Ja(k,a),!0):!1:!1},w.COMMAND_PRIORITY_CRITICAL));return g};exports.getDOMCellFromTarget=va;exports.getTableObserverFromTableElement=ua
